!function(b){var a=function(d,c){this.options=c;this.$element=b(d);this.$container=b('<div id="ms-'+this.$element.attr("id")+'" class="ms-container"></div>');this.$selectableContainer=b('<div class="ms-selectable"></div>');this.$selectionContainer=b('<div class="ms-selection"></div>');this.$selectableUl=b('<ul class="ms-list"></ul>');this.$selectionUl=b('<ul class="ms-list"></ul>');this.scrollTo=0};a.prototype={constructor:a,init:function(){var i=this,e=this.$element;if(e.next(".ms-container").length==0){e.css({position:"absolute",left:"-9999px"});e.attr("id",e.attr("id")?e.attr("id"):"ms-"+Math.ceil(Math.random()*1000));var f=null,h=null,k=0,l=0,c='<li class="ms-optgroup-container"></li>',d='<ul class="ms-optgroup"></ul>',g='<li class="ms-optgroup-label"><span></span></li>';e.find("optgroup, option").each(function(){if(b(this).is("optgroup")){f="<span>"+b(this).attr("label")+"</span>";h="ms-"+e.attr("id")+"-optgroup-"+k;var n=b(this),r=b(c),u=b(c),p=b(g),x=b(g);if(i.options.selectableOptgroup){x.on("click",function(){var y=n.children(":not(:selected)").map(function(){return b(this).val()}).get();i.select(y)});p.on("click",function(){var y=n.children(":selected").map(function(){return b(this).val()}).get();i.deselect(y)})}x.html(f);r.attr("id",h+"-selectable").append(b(d).append(x));i.$selectableUl.append(r);p.html(f);u.attr("id",h+"-selection").append(b(d).append(p));i.$selectionUl.append(u);k++}else{var o="";for(var q=0;q<this.attributes.length;q++){var s=this.attributes[q];if(i.isDomNode(s.name)){o+=s.name+'="'+s.value+'" '}}var t=b("<li "+o+"><span>"+b(this).text()+"</span></li>"),m=t.clone();var w=b(this).val(),v=i.sanitize(w);t.data("ms-value",w).addClass("ms-elem-selectable").attr("id",v+"-selectable");m.data("ms-value",w).addClass("ms-elem-selection").attr("id",v+"-selection").hide();i.$selectionUl.find(".ms-optgroup-label").hide();if(b(this).prop("disabled")||e.prop("disabled")){t.prop("disabled",true);t.addClass(i.options.disabledClass)}if(h){i.$selectableUl.children("#"+h+"-selectable").find("ul").first().append(t);i.$selectionUl.children("#"+h+"-selection").find("ul").first().append(m)}else{i.$selectableUl.append(t);i.$selectionUl.append(m)}}});if(i.options.selectableHeader){i.$selectableContainer.append(i.options.selectableHeader)}i.$selectableContainer.append(i.$selectableUl);if(i.options.selectionHeader){i.$selectionContainer.append(i.options.selectionHeader)}this.$selectionContainer.append(i.$selectionUl);i.$container.append(i.$selectableContainer);i.$container.append(i.$selectionContainer);e.after(i.$container);i.$selectableUl.on("mouseenter",".ms-elem-selectable",function(){b("li",i.$container).removeClass("ms-hover");b(this).addClass("ms-hover")}).on("mouseleave",function(){b("li",i.$container).removeClass("ms-hover")});if(i.options.dblClick){i.$selectableUl.on("dblclick",".ms-elem-selectable",function(){i.select(b(this).data("ms-value"))});i.$selectionUl.on("dblclick",".ms-elem-selection",function(){i.deselect(b(this).data("ms-value"))})}else{i.$selectableUl.on("click",".ms-elem-selectable",function(){i.select(b(this).data("ms-value"))});i.$selectionUl.on("click",".ms-elem-selection",function(){i.deselect(b(this).data("ms-value"))})}i.$selectionUl.on("mouseenter",".ms-elem-selection",function(){b("li",i.$selectionUl).removeClass("ms-hover");b(this).addClass("ms-hover")}).on("mouseleave",function(){b("li",i.$selectionUl).removeClass("ms-hover")});i.$selectableUl.on("focusin",function(){b(this).addClass("ms-focus");i.$selectionUl.focusout()}).on("focusout",function(){b(this).removeClass("ms-focus");b("li",i.$container).removeClass("ms-hover")});i.$selectionUl.on("focusin",function(){b(this).addClass("ms-focus")}).on("focusout",function(){b(this).removeClass("ms-focus");b("li",i.$container).removeClass("ms-hover")});e.on("focusin",function(){e.focusout();i.$selectableUl.focusin()}).on("focusout",function(){i.$selectableUl.removeClass("ms-focus");i.$selectionUl.removeClass("ms-focus")});e.onKeyDown=function(y,s){var u=i.$container.find("."+s).find(".ms-list"),m=u.find("li:visible:not(.ms-optgroup-label, .ms-optgroup-container)"),C=m.length,z=u.find("li.ms-hover"),r=z.length>0?m.index(z):-1,D=u.innerHeight(),q=m.first().outerHeight(true),w=Math.floor(D/q);if(y.keyCode==32){if(z.length>0){var p=s=="ms-selectable"?"select":"deselect";if(s=="ms-selectable"){i.select(z.attr("id").replace("-selectable",""))}else{i.deselect(z.attr("id").replace("-selection",""))}m.removeClass("ms-hover");i.scrollTo=0;u.scrollTop(i.scrollTo)}}else{if(y.keyCode==40){if(m.length>0){var o=r+1,t=(C!=o)?m.eq(o):m.first(),x=u.position().top,B=t.position().top;m.removeClass("ms-hover");t.addClass("ms-hover");if(C==o){i.scrollTo=0}else{if(B>=(x+(w*q))){i.scrollTo+=q}}u.scrollTop(i.scrollTo)}}else{if(y.keyCode==38){if(m.length>0){var v=Math.max(r-1,-1),n=m.eq(v),x=u.position().top,A=n.position().top;m.removeClass("ms-hover");n.addClass("ms-hover");if(A<=x){i.scrollTo-=q}else{if(v<0){i.scrollTo=(C-w)*q}}u.scrollTop(i.scrollTo)}}else{if(y.keyCode==37||y.keyCode==39){if(i.$selectableUl.hasClass("ms-focus")){i.$selectableUl.focusout();i.$selectionUl.focusin()}else{i.$selectableUl.focusin();i.$selectionUl.focusout()}}}}}};e.on("keydown",function(n){if(e.is(":focus")){var m=i.$selectableUl.hasClass("ms-focus")?"ms-selectable":"ms-selection";e.onKeyDown(n,m)}})}var j=e.find("option:selected").map(function(){return b(this).val()}).get();i.select(j,"init");if(typeof i.options.afterInit=="function"){i.options.afterInit.call(this,this.$container)}},refresh:function(){b("#ms-"+this.$element.attr("id")).remove();this.init(this.options)},select:function(k,c){if(typeof k=="string"){k=[k]}var f=this,d=this.$element,g=b.map(k,function(n,m){return(f.sanitize(n))}),h=this.$selectableUl.find("#"+g.join("-selectable, #")+"-selectable").filter(":not(."+f.options.disabledClass+")"),e=this.$selectionUl.find("#"+g.join("-selection, #")+"-selection"),l=d.find("option").filter(function(m){return(b.inArray(this.value,k)>-1)});if(h.length>0){h.addClass("ms-selected").hide();e.addClass("ms-selected").show();l.prop("selected",true);var j=f.$selectableUl.children(".ms-optgroup-container");if(j.length>0){j.each(function(){var m=b(this).find(".ms-elem-selectable");if(m.length==m.filter(".ms-selected").length){b(this).find(".ms-optgroup-label").hide()}});var i=f.$selectionUl.children(".ms-optgroup-container");i.each(function(){var m=b(this).find(".ms-elem-selection");if(m.filter(".ms-selected").length>0){b(this).find(".ms-optgroup-label").show()}})}if(c!="init"){f.$selectionUl.focusout();f.$selectableUl.focusin();d.trigger("change");if(typeof f.options.afterSelect=="function"){f.options.afterSelect.call(this,k)}}}},deselect:function(j){if(typeof j=="string"){j=[j]}var e=this,c=this.$element,f=b.map(j,function(m,l){return(e.sanitize(m))}),g=this.$selectableUl.find("#"+f.join("-selectable, #")+"-selectable"),d=this.$selectionUl.find("#"+f.join("-selection, #")+"-selection").filter(".ms-selected"),k=c.find("option").filter(function(l){return(b.inArray(this.value,j)>-1)});if(d.length>0){g.removeClass("ms-selected").show();d.removeClass("ms-selected").hide();k.prop("selected",false);var i=e.$selectableUl.children(".ms-optgroup-container");if(i.length>0){i.each(function(){var l=b(this).find(".ms-elem-selectable");if(l.filter(":not(.ms-selected)").length>0){b(this).find(".ms-optgroup-label").show()}});var h=e.$selectionUl.children(".ms-optgroup-container");h.each(function(){var l=b(this).find(".ms-elem-selection");if(l.filter(".ms-selected").length==0){b(this).find(".ms-optgroup-label").hide()}})}this.$selectableUl.focusout();this.$selectionUl.focusin();c.trigger("change");if(typeof e.options.afterDeselect=="function"){e.options.afterDeselect.call(this,j)}}},select_all:function(){var c=this.$element;c.find("option").prop("selected",true);this.$selectableUl.find(".ms-elem-selectable").addClass("ms-selected").hide();this.$selectionUl.find(".ms-optgroup-label").show();this.$selectableUl.find(".ms-optgroup-label").hide();this.$selectionUl.find(".ms-elem-selection").addClass("ms-selected").show();this.$selectionUl.focusin();this.$selectableUl.focusout();c.trigger("change")},deselect_all:function(){var c=this.$element;c.find("option").prop("selected",false);this.$selectableUl.find(".ms-elem-selectable").removeClass("ms-selected").show();this.$selectionUl.find(".ms-optgroup-label").hide();this.$selectableUl.find(".ms-optgroup-label").show();this.$selectionUl.find(".ms-elem-selection").removeClass("ms-selected").hide();this.$selectableUl.focusin();this.$selectionUl.focusout();c.trigger("change")},isDomNode:function(c){return(c&&typeof c==="object"&&typeof c.nodeType==="number"&&typeof c.nodeName==="string")},sanitize:function(c){return(c.replace(/[^A-Za-z0-9]*/gi,"_"))}};b.fn.multiSelect=function(){var d=arguments[0],c=arguments;return this.each(function(){var g=b(this),f=g.data("multiselect"),e=b.extend({},b.fn.multiSelect.defaults,g.data(),typeof d=="object"&&d);if(!f){g.data("multiselect",(f=new a(this,e)))}if(typeof d=="string"){f[d](c[1])}else{f.init()}})};b.fn.multiSelect.defaults={selectableOptgroup:false,disabledClass:"disabled",dblClick:false};b.fn.multiSelect.Constructor=a}(window.jQuery);